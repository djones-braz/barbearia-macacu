<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barbearia Macacu - Agendamento</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome (Ícones) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script>
        // Configuração do Tailwind para usar a fonte 'Inter'
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: '#1E3A8A', // Azul escuro
                        secondary: '#D1D5DB', // Cinza claro
                        accent: '#F59E0B', // Amarelo/Laranja
                    }
                }
            }
        }
    </script>
    <style>
        /* Estilo para a fonte Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Fundo cinza bem claro */
        }
        /* Esconde todas as telas por padrão */
        .page-screen {
            display: none;
        }
    </style>
</head>
<body class="text-gray-900">

    <!-- =========== MODAL DE CARREGAMENTO (LOADING) =========== -->
    <div id="loadingModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="flex flex-col items-center justify-center bg-white p-6 rounded-lg shadow-xl">
            <i class="fas fa-spinner fa-spin text-3xl text-primary"></i>
            <span class="mt-3 font-medium">Carregando...</span>
        </div>
    </div>
    
    <!-- =========== MODAL DE MENSAGEM (ERRO/SUCESSO) =========== -->
    <div id="messageModal" class="fixed top-5 right-5 z-50 hidden transition-transform translate-x-full">
        <div id="messageModalContent" class="flex items-center p-4 rounded-lg shadow-lg text-white">
            <i id="messageModalIcon" class="fas fa-info-circle text-lg mr-3"></i>
            <span id="messageModalText">Mensagem</span>
        </div>
    </div>


    <!-- =========== CONTAINER PRINCIPAL =========== -->
    <div class="container mx-auto max-w-7xl p-4">

        <!-- ============================================== -->
        <!-- ===== TELA 1: FLUXO DE AGENDAMENTO (PÚBLICO) ===== -->
        <!-- ============================================== -->
        <div id="public-booking" class="page-screen">
            <header class="flex justify-between items-center py-4 border-b">
                <h1 class="text-2xl font-bold text-primary">Barbearia Macacu</h1>
                <nav class="flex items-center space-x-4">
                    <a href="#booking" class="font-medium text-primary">Agendamento</a>
                    <a href="#meus-agendamentos" class="font-medium text-gray-600 hover:text-primary">Meus Agendamentos</a>
                    <a id="nav-public-login" href="#login" class="font-medium text-gray-600 hover:text-primary">Minha Conta</a>
                    <a id="nav-public-dashboard" href="#dashboard" class="hidden font-medium text-gray-600 hover:text-primary">Meu Painel</a>
                </nav>
            </header>

            <main class="bg-white p-8 rounded-lg shadow-lg mt-6">
                <h2 class="text-3xl font-bold text-center">Agende seu horário</h2>
                <p class="text-center text-gray-600 mt-2">Siga os passos para garantir o seu horário conosco.</p>

                <!-- Etapas do Agendamento -->
                <div class="flex justify-center space-x-4 my-8">
                    <div id="step-1" class="step-indicator flex items-center">
                        <span class="flex items-center justify-center w-8 h-8 rounded-full bg-primary text-white font-bold">1</span>
                        <span class="ml-2 font-semibold text-primary">Serviço</span>
                    </div>
                    <div class="text-gray-400 font-bold mx-2">→</div>
                    <div id="step-2" class="step-indicator opacity-50 flex items-center">
                        <span class="flex items-center justify-center w-8 h-8 rounded-full bg-gray-300 text-gray-600 font-bold">2</span>
                        <span class="ml-2 font-semibold text-gray-500">Barbeiro</span>
                    </div>
                    <div class="text-gray-400 font-bold mx-2">→</div>
                    <div id="step-3" class="step-indicator opacity-50 flex items-center">
                        <span class="flex items-center justify-center w-8 h-8 rounded-full bg-gray-300 text-gray-600 font-bold">3</span>
                        <span class="ml-2 font-semibold text-gray-500">Horário</span>
                    </div>
                    <div class="text-gray-400 font-bold mx-2">→</div>
                    <div id="step-4" class="step-indicator opacity-50 flex items-center">
                        <span class="flex items-center justify-center w-8 h-8 rounded-full bg-gray-300 text-gray-600 font-bold">4</span>
                        <span class="ml-2 font-semibold text-gray-500">Confirmação</span>
                    </div>
                </div>
                
                <!-- Etapa 1: Seleção de Serviço -->
                <div id="booking-step-1" class="booking-step">
                    <h3 class="text-2xl font-semibold mb-6">Qual serviço você deseja?</h3>
                    <div id="servicesList" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Carregando Serviços... -->
                        <div class="border rounded-lg p-4 text-center text-gray-500">
                            <div class="h-40 bg-gray-200 rounded-md animate-pulse mb-4"></div>
                            <div class="h-6 bg-gray-200 rounded-md animate-pulse w-3/4 mx-auto mb-2"></div>
                            <div class="h-4 bg-gray-200 rounded-md animate-pulse w-1/2 mx-auto"></div>
                        </div>
                    </div>
                    <div class="text-right mt-8">
                        <button id="btn-next-step-1" class="bg-primary text-white py-3 px-6 rounded-lg font-semibold hover:bg-opacity-90 transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            Avançar <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Outras Etapas (a implementar) -->
                
            </main>
        </div>
        
        <!-- ============================================== -->
        <!-- ===== TELA 2: LOGIN (AUTENTICAÇÃO)         ===== -->
        <!-- ============================================== -->
        <div id="login" class="page-screen flex items-center justify-center min-h-screen">
            <div class="bg-white p-10 rounded-xl shadow-2xl w-full max-w-md">
                <img src="https://placehold.co/100x100/1E3A8A/FFFFFF?text=BM" alt="Logo Barbearia" class="w-24 h-24 mx-auto rounded-full mb-6 -mt-20 border-4 border-white">
                <h2 class="text-3xl font-bold text-center text-primary mb-2">Acesse sua Conta</h2>
                <p class="text-center text-gray-600 mb-8">Bem-vindo de volta!</p>
                
                <form id="loginForm">
                    <div class="mb-4">
                        <label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <div class="relative">
                            <i class="fas fa-envelope absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="email" id="loginEmail" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="seu.email@exemplo.com" required>
                        </div>
                    </div>
                    <div class="mb-6">
                        <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="password" id="loginPassword" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Sua senha" required>
                        </div>
                        <a href="#" class="text-sm text-primary hover:underline mt-2 block text-right">Esqueceu a senha?</a>
                    </div>
                    
                    <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg font-semibold hover:bg-opacity-90 transition-all text-lg">
                        Entrar
                    </button>
                </form>
                
                <p class="text-center text-gray-600 mt-6">
                    Não possui uma conta? <a href="#signup" class="font-semibold text-primary hover:underline">Cadastre-se</a>
                </p>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- ===== TELA 3: CADASTRO (AUTENTICAÇÃO)      ===== -->
        <!-- ============================================== -->
        <div id="signup" class="page-screen flex items-center justify-center min-h-screen">
            <div class="bg-white p-10 rounded-xl shadow-2xl w-full max-w-lg">
                <img src="https://placehold.co/100x100/1E3A8A/FFFFFF?text=BM" alt="Logo Barbearia" class="w-24 h-24 mx-auto rounded-full mb-6 -mt-20 border-4 border-white">
                <h2 class="text-3xl font-bold text-center text-primary mb-2">Crie sua Conta</h2>
                <p class="text-center text-gray-600 mb-6">Selecione seu perfil e preencha os campos abaixo.</p>

                <!-- Seleção de Perfil -->
                <div class="flex justify-center mb-6 rounded-lg bg-gray-100 p-1">
                    <button id="btn-profile-cliente" class="profile-toggle-btn flex-1 py-2 px-4 rounded-md font-semibold text-white bg-primary">Cliente</button>
                    <button id="btn-profile-barbeiro" class="profile-toggle-btn flex-1 py-2 px-4 rounded-md font-semibold text-gray-600">Barbeiro</button>
                    <button id="btn-profile-admin" class="profile-toggle-btn flex-1 py-2 px-4 rounded-md font-semibold text-gray-600">Admin</button>
                </div>

                <form id="signupForm">
                    <input type="hidden" id="signupTipoPerfil" value="Cliente">
                    <div class="mb-4">
                        <label for="signupNome" class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                        <div class="relative">
                            <i class="fas fa-user absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="text" id="signupNome" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Digite seu nome completo" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="signupEmail" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <div class="relative">
                            <i class="fas fa-envelope absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="email" id="signupEmail" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Digite seu e-mail" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="signupPassword" class="block text-sm font-medium text-gray-700 mb-2">Crie uma senha</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="password" id="signupPassword" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Crie uma senha" required>
                        </div>
                    </div>
                    <div class="mb-6">
                        <label for="signupConfirmPassword" class="block text-sm font-medium text-gray-700 mb-2">Confirme sua Senha</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="password" id="signupConfirmPassword" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Repita a senha" required>
                        </div>
                        <p id="passwordError" class="text-red-500 text-sm mt-1 hidden">As senhas não coincidem.</p>
                    </div>

                    <div class="mb-6 flex items-center">
                        <input type="checkbox" id="signupTerms" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded" required>
                        <label for="signupTerms" class="ml-2 block text-sm text-gray-700">Eu li e aceito os <a href="#" class="text-primary hover:underline">Termos de Serviço</a></label>
                    </div>
                    
                    <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg font-semibold hover:bg-opacity-90 transition-all text-lg">
                        Cadastrar
                    </button>
                </form>
                
                <p class="text-center text-gray-600 mt-6">
                    Já possui uma conta? <a href="#login" class="font-semibold text-primary hover:underline">Entrar</a>
                </p>
            </div>
        </div>

        <!-- ============================================== -->
        <!-- ===== TELA 4: PAINEL ADMIN / BARBEIRO      ===== -->
        <!-- ============================================== -->
        <div id="admin-dashboard" class="page-screen">
            <div class="flex h-screen">
                <!-- Sidebar -->
                <aside class="w-64 bg-primary text-white flex flex-col fixed h-full">
                    <div class="p-6 border-b border-blue-800">
                        <h2 class="text-xl font-bold">Barbearia Macacu</h2>
                        <span id="userProfileName" class="text-sm text-blue-200">Painel Admin</span>
                    </div>
                    <nav class="flex-1 p-4 space-y-2">
                        <a href="#dashboard" class="nav-link-admin active bg-blue-700" data-target="panel-dashboard">
                            <i class="fas fa-tachometer-alt w-6"></i> Dashboard
                        </a>
                        <a href="#agenda" class="nav-link-admin" data-target="panel-agenda">
                            <i class="fas fa-calendar-alt w-6"></i> Agenda
                        </a>
                        <a href="#servicos" class="nav-link-admin" data-target="panel-servicos">
                            <i class="fas fa-cut w-6"></i> Serviços
                        </a>
                        <a href="#clientes" class="nav-link-admin" data-target="panel-clientes">
                            <i class="fas fa-users w-6"></i> Clientes
                        </a>
                        <a href="#financeiro" class="nav-link-admin" data-target="panel-financeiro">
                            <i class="fas fa-dollar-sign w-6"></i> Financeiro
                        </a>
                        <a href="#configuracoes" class="nav-link-admin" data-target="panel-configuracoes">
                            <i class="fas fa-cog w-6"></i> Configurações
                        </a>
                    </nav>
                    <div class="p-4 border-t border-blue-800">
                        <a href="#logout" id="btnLogout" class="flex items-center p-2 rounded-lg text-blue-200 hover:bg-blue-700 hover:text-white">
                            <i class="fas fa-sign-out-alt w-6"></i> Sair
                        </a>
                    </div>
                </aside>

                <!-- Conteúdo Principal -->
                <main class="flex-1 ml-64 bg-gray-100 p-8 overflow-y-auto">
                    <!-- Header do Painel -->
                    <header class="flex justify-between items-center mb-8">
                        <div>
                            <h1 id="panelTitle" class="text-3xl font-bold text-gray-800">Dashboard</h1>
                            <p id="panelSubtitle" class="text-gray-600">Olá, <span id="userName">Usuário</span>! Veja seu resumo.</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <button class="text-gray-500 hover:text-gray-800">
                                <i class="fas fa-bell fa-lg"></i>
                            </button>
                            <img id="userAvatar" src="https://placehold.co/40x40/E2E8F0/718096?text=U" alt="Avatar" class="w-10 h-10 rounded-full border-2 border-gray-300">
                        </div>
                    </header>

                    <!-- Container dos Painéis -->
                    <div class="panel-content">

                        <!-- Painel: Dashboard (Tela 3) -->
                        <div id="panel-dashboard" class="admin-panel">
                            <!-- Cards de Resumo -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div class="bg-white p-6 rounded-lg shadow-md">
                                    <h3 class="text-gray-500">Faturamento do Dia</h3>
                                    <p class="text-3xl font-bold text-gray-800">R$ 350,00</p>
                                    <span class="text-green-500 font-semibold">+5.2% vs ontem</span>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-md">
                                    <h3 class="text-gray-500">Agendamentos para Hoje</h3>
                                    <p class="text-3xl font-bold text-gray-800">7</p>
                                    <span class="text-green-500 font-semibold">+2 vs ontem</span>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-md">
                                    <h3 class="text-gray-500">Meta Mensal</h3>
                                    <div class="w-full bg-gray-200 rounded-full h-2.5 my-2">
                                        <div class="bg-primary h-2.5 rounded-full" style="width: 75%"></div>
                                    </div>
                                    <span class="text-gray-600">R$ 3.750 / R$ 5.000 (75%)</span>
                                </div>
                            </div>
                            
                            <!-- Sua Agenda -->
                            <div>
                                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Sua Agenda</h2>
                                <!-- Filtros de Agenda -->
                                <div class="flex justify-end space-x-2 mb-4">
                                    <button class="py-2 px-4 rounded-lg bg-primary text-white font-semibold">Hoje</button>
                                    <button class="py-2 px-4 rounded-lg bg-white text-gray-700 font-semibold border">Semana</button>
                                    <button class="py-2 px-4 rounded-lg bg-white text-gray-700 font-semibold border">Mês</button>
                                </div>
                                <!-- Lista de Agendamentos -->
                                <div class="bg-white p-6 rounded-lg shadow-md space-y-4">
                                    <!-- Item Agenda -->
                                    <div class="flex items-center justify-between p-4 rounded-lg border">
                                        <div class="flex items-center">
                                            <span class="text-lg font-bold text-primary mr-4">09:00 <span class="text-sm font-normal block -mt-1">AM</span></span>
                                            <div>
                                                <p class="font-semibold text-gray-800">Carlos Pereira</p>
                                                <span class="text-sm text-gray-500">Corte de Cabelo</span>
                                            </div>
                                        </div>
                                        <button class="py-2 px-4 rounded-full bg-green-100 text-green-700 font-semibold hover:bg-green-200">
                                            <i class="fas fa-comment-dots mr-2"></i> Lembrete
                                        </button>
                                    </div>
                                    <!-- Item Agenda -->
                                    <div class="flex items-center justify-between p-4 rounded-lg border">
                                        <div class="flex items-center">
                                            <span class="text-lg font-bold text-primary mr-4">10:30 <span class="text-sm font-normal block -mt-1">AM</span></span>
                                            <div>
                                                <p class="font-semibold text-gray-800">Ricardo Alves</p>
                                                <span class="text-sm text-gray-500">Barba e Cabelo</span>
                                            </div>
                                        </div>
                                        <button class="py-2 px-4 rounded-full bg-green-100 text-green-700 font-semibold hover:bg-green-200">
                                            <i class="fas fa-comment-dots mr-2"></i> Lembrete
                                        </button>
                                    </div>
                                    <!-- Item Agenda (Cancelado/Destaque) -->
                                    <div class="flex items-center justify-between p-4 rounded-lg border-l-4 border-red-500 bg-red-50">
                                        <div class="flex items-center">
                                            <span class="text-lg font-bold text-red-600 mr-4">11:00 <span class="text-sm font-normal block -mt-1">AM</span></span>
                                            <div>
                                                <p class="font-semibold text-red-700">Mariana Costa</p>
                                                <span class="text-sm text-red-600">Corte Feminino (Encaixe)</span>
                                            </div>
                                        </div>
                                        <button class="py-2 px-4 rounded-full bg-green-100 text-green-700 font-semibold hover:bg-green-200">
                                            <i class="fas fa-comment-dots mr-2"></i> Lembrete
                                        </button>
                                    </div>
                                    
                                    <!-- Estado Vazio -->
                                    <div class="text-center text-gray-500 py-12">
                                        <i class="fas fa-calendar-times text-4xl mb-4"></i>
                                        <p class="font-semibold">Nenhum agendamento para a tarde.</p>
                                        <p class="text-sm">Aproveite para organizar suas ferramentas!</p>
                                    </div>
                                </div>
                            </div>
                            
                            <button class="fixed bottom-8 right-8 bg-primary text-white py-4 px-6 rounded-full shadow-lg hover:bg-opacity-90 transition-all">
                                <i class="fas fa-plus"></i> Novo Agendamento
                            </button>
                        </div>
                        
                        <!-- Painel: Serviços (Tela 5) -->
                        <div id="panel-servicos" class="admin-panel hidden">
                            <div class="flex justify-between items-center mb-8">
                                <div>
                                    <h1 class="text-3xl font-bold text-gray-800">Gerenciamento de Serviços</h1>
                                    <p class="text-gray-600">Adicione, edite ou remova os serviços oferecidos.</p>
                                </div>
                                <button id="btn-add-service-modal" class="bg-primary text-white py-2 px-4 rounded-lg font-semibold flex items-center hover:bg-opacity-90">
                                    <i class="fas fa-plus mr-2"></i> Adicionar Serviço
                                </button>
                            </div>
                            
                            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="p-4 text-left text-sm font-semibold text-gray-600">Serviço</th>
                                            <th class="p-4 text-left text-sm font-semibold text-gray-600">Preço (R$)</th>
                                            <th class="p-4 text-left text-sm font-semibold text-gray-600">Duração (min)</th>
                                            <th class="p-4 text-left text-sm font-semibold text-gray-600">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adminServicesList">
                                        <!-- Linhas de serviço serão injetadas aqui -->
                                        <tr><td colspan="4" class="p-6 text-center text-gray-500">Carregando serviços...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Estado Vazio Serviços -->
                            <div id="adminServicesEmpty" class="hidden text-center bg-white p-12 rounded-lg shadow-md mt-8 text-gray-500">
                                <i class="fas fa-lightbulb text-4xl mb-4 text-yellow-400"></i>
                                <p class="text-xl font-semibold mb-2">Nenhum serviço encontrado</p>
                                <p class="mb-4">Clique no botão abaixo para começar a cadastrar.</p>
                                <button id="btn-add-service-empty" class="bg-primary text-white py-2 px-4 rounded-lg font-semibold hover:bg-opacity-90">
                                    <i class="fas fa-plus mr-2"></i> Adicionar Serviço
                                </button>
                            </div>

                        </div>
                        
                        <!-- Painel: Clientes (Tela 6) -->
                        <div id="panel-clientes" class="admin-panel hidden">
                            <div class="flex justify-between items-center mb-8">
                                <div>
                                    <h1 class="text-3xl font-bold text-gray-800">Gerenciamento de Clientes (CRM)</h1>
                                    <p class="text-gray-600">Visualize e gerencie as informações dos seus clientes.</p>
                                </div>
                                <button class="bg-red-500 text-white py-2 px-4 rounded-lg font-semibold flex items-center hover:bg-red-600">
                                    <i class="fas fa-paper-plane mr-2"></i> Enviar Notificação em Massa
                                </button>
                            </div>
                            
                            <div class="flex gap-8">
                                <!-- Coluna da Lista de Clientes -->
                                <div class="w-1/3">
                                    <div class="relative mb-4">
                                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                        <input type="text" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg" placeholder="Buscar cliente por nome, telefone...">
                                    </div>
                                    <div class="flex justify-between items-center mb-4 text-sm">
                                        <span class="text-gray-600">Ordenar por: <span class="font-semibold text-gray-800">Última visita <i class="fas fa-chevron-down ml-1"></i></span></span>
                                        <span class="text-gray-600">Filtrar por: <span class="font-semibold text-gray-800">Aniversariantes <i class="fas fa-chevron-down ml-1"></i></span></span>
                                    </div>
                                    <div id="clientListCRM" class="bg-white rounded-lg shadow-md overflow-hidden divide-y">
                                        <!-- Clientes injetados aqui -->
                                        <div class="p-4 text-center text-gray-500">Carregando clientes...</div>
                                    </div>
                                </div>
                                
                                <!-- Coluna de Detalhes do Cliente -->
                                <div class="w-2/3">
                                    <div id="clientDetailCRM" class="bg-white rounded-lg shadow-md p-8">
                                        <!-- Detalhes do cliente selecionado -->
                                        <div class="text-center text-gray-500 py-16">
                                            <i class="fas fa-hand-pointer text-4xl mb-4"></i>
                                            <p class="text-lg">Selecione um cliente à esquerda para ver os detalhes.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Painel: Financeiro (Tela 4) -->
                        <div id="panel-financeiro" class="admin-panel hidden">
                             <!-- Cards de Resumo -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-primary">
                                    <h3 class="text-gray-500">Faturamento Total (Barbearia)</h3>
                                    <p class="text-3xl font-bold text-gray-800">R$ 12.450,00</p>
                                    <span class="text-green-500 font-semibold">+5.2% vs mês anterior</span>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-md">
                                    <h3 class="text-gray-500">Meu Faturamento</h3>
                                    <p class="text-3xl font-bold text-gray-800">R$ 4.500,00</p>
                                    <span class="text-green-500 font-semibold">+8.1% vs mês anterior</span>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-md">
                                    <h3 class="text-gray-500">Minha Comissão</h3>
                                    <p class="text-3xl font-bold text-gray-800">R$ 1.800,00</p>
                                    <span class="text-green-600 font-semibold">Status: Pago</span>
                                </div>
                            </div>
                            
                            <!-- Gráficos e Relatórios -->
                            <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                                <div class="lg:col-span-3 bg-white p-6 rounded-lg shadow-md">
                                    <h3 class="text-lg font-semibold mb-4">Meus Últimos Atendimentos</h3>
                                    <table class="w-full">
                                        <thead>
                                            <tr class="border-b">
                                                <th class="p-2 text-left text-sm font-semibold text-gray-600">Cliente</th>
                                                <th class="p-2 text-left text-sm font-semibold text-gray-600">Valor</th>
                                                <th class="p-2 text-left text-sm font-semibold text-gray-600">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="p-2">Fernando Lima</td>
                                                <td class="p-2">R$ 50,00</td>
                                                <td class="p-2"><span class="py-1 px-2 rounded-full bg-green-100 text-green-700 text-xs">Pago</span></td>
                                            </tr>
                                            <tr>
                                                <td class="p-2">Gabriel Costa</td>
                                                <td class="p-2">R$ 85,00</td>
                                                <td class="p-2"><span class="py-1 px-2 rounded-full bg-green-100 text-green-700 text-xs">Pago</span></td>
                                            </tr>
                                            <tr>
                                                <td class="p-2">Lucas Martins</td>
                                                <td class="p-2">R$ 45,00</td>
                                                <td class="p-2"><span class="py-1 px-2 rounded-full bg-yellow-100 text-yellow-700 text-xs">A Receber</span></td>
                                            </tr>
                                            <tr>
                                                <td class="p-2">André Santos</td>
                                                <td class="p-2">R$ 50,00</td>
                                                <td class="p-2"><span class="py-1 px-2 rounded-full bg-red-100 text-red-700 text-xs">Cancelado</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                                    <h3 class="text-lg font-semibold mb-4">Status dos Pagamentos</h3>
                                    <div class="flex items-center justify-center">
                                        <!-- Placeholder para Gráfico Donut -->
                                        <div class="w-48 h-48 bg-gray-200 rounded-full flex items-center justify-center relative">
                                            <div class="w-32 h-32 bg-white rounded-full"></div>
                                            <span class="absolute text-3xl font-bold">105</span>
                                            <span class="absolute bottom-16 text-gray-600">Total</span>
                                        </div>
                                    </div>
                                    <ul class="mt-4 space-y-2 text-sm">
                                        <li class="flex items-center justify-between"><span class_alias="flex items-center"><i class="fas fa-circle text-green-500 mr-2"></i> Pagos</span> <span>73</span></li>
                                        <li class="flex items-center justify-between"><span class_alias="flex items-center"><i class="fas fa-circle text-yellow-500 mr-2"></i> A Receber</span> <span>21</span></li>
                                        <li class="flex items-center justify-between"><span class_alias="flex items-center"><i class="fas fa-circle text-red-500 mr-2"></i> Cancelados</span> <span>11</span></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Outros Painéis (Agenda, Configurações) -->
                        <div id="panel-agenda" class="admin-panel hidden">
                            <h1 class="text-2xl">Página da Agenda</h1>
                            <p>Conteúdo da agenda aqui...</p>
                        </div>
                        <div id="panel-configuracoes" class="admin-panel hidden">
                            <h1 class="text-2xl">Página de Configurações</h1>
                            <p>Conteúdo das configurações aqui...</p>
                        </div>

                    </div>
                </main>
            </div>
        </div>


    </div> <!-- Fim do Container Principal -->
    
    <!-- ============================================== -->
    <!-- ===== MODAL: ADICIONAR/EDITAR SERVIÇO     ===== -->
    <!-- ============================================== -->
    <div id="serviceModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-40 hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-lg">
            <div class="flex justify-between items-center mb-6">
                <h2 id="serviceModalTitle" class="text-2xl font-bold">Adicionar Novo Serviço</h2>
                <button id="closeServiceModal" class="text-gray-500 hover:text-gray-800">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <form id="serviceForm">
                <input type="hidden" id="serviceId">
                <div class="mb-4">
                    <label for="serviceName" class="block text-sm font-medium text-gray-700 mb-2">Nome do Serviço</label>
                    <input type="text" id="serviceName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="servicePrice" class="block text-sm font-medium text-gray-700 mb-2">Preço (R$)</label>
                        <input type="number" id="servicePrice" step="0.01" min="0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                    </div>
                    <div>
                        <label for="serviceDuration" class="block text-sm font-medium text-gray-700 mb-2">Duração (minutos)</label>
                        <input type="number" id="serviceDuration" min="0" step="5" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                    </div>
                </div>
                <div class="mb-6">
                    <label for="serviceDescription" class="block text-sm font-medium text-gray-700 mb-2">Descrição (Opcional)</label>
                    <textarea id="serviceDescription" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"></textarea>
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancelServiceModal" class="bg-gray-200 text-gray-700 py-2 px-6 rounded-lg font-semibold hover:bg-gray-300">
                        Cancelar
                    </button>
                    <button type="submit" class="bg-primary text-white py-2 px-6 rounded-lg font-semibold hover:bg-opacity-90">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>


    <script>
        // =============================================
        // == CONFIGURAÇÃO DA API (Google Apps Script) ==
        // =============================================
        
        // !!! IMPORTANTE !!!
        // Cole aqui a URL do seu Google Apps Script depois de implantá-lo.
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzueay0LGwhm6PKfHFjHlZtkS4kkBG-n_i0YaeB4t9QEKpcQtz6upAIdxF7N2aFmYft4g/exec";
        
        // =============================================
        // == LÓGICA DE NAVEGAÇÃO SPA (Single Page App) ==
        // =============================================
        
        const allPages = document.querySelectorAll('.page-screen');
        const allAdminPanels = document.querySelectorAll('.admin-panel');
        const adminNavLinks = document.querySelectorAll('.nav-link-admin');
        const adminPanelTitle = document.getElementById('panelTitle');
        const adminPanelSubtitle = document.getElementById('panelSubtitle');
        const userNameEl = document.getElementById('userName');

        // Estado da Aplicação
        let appState = {
            currentUser: null, // { id, nome, email, tipoPerfil }
            services: [],
            clients: [],
            selectedService: null,
            selectedBarber: null,
            selectedDateTime: null,
        };

        // Roteador Principal
        function handleRouting() {
            const hash = window.location.hash || '#booking'; // Tela padrão
            
            // 1. Esconde todas as telas
            allPages.forEach(page => page.style.display = 'none');
            
            // 2. Verifica autenticação
            const user = getCurrentUser();
            const isAuthenticated = !!user;

            // 3. Lógica de Roteamento
            if (hash.startsWith('#dashboard') || hash.startsWith('#agenda') || hash.startsWith('#servicos') || hash.startsWith('#clientes') || hash.startsWith('#financeiro') || hash.startsWith('#configuracoes')) {
                if (isAuthenticated && (user.tipoPerfil === 'Admin' || user.tipoPerfil === 'Barbeiro')) {
                    // Usuário logado e é Admin/Barbeiro
                    document.getElementById('admin-dashboard').style.display = 'block';
                    navigateToAdminPanel(hash);
                } else {
                    // Não tem permissão ou não está logado
                    window.location.hash = '#login';
                }
            } else if (hash === '#login' || hash === '#signup') {
                if (isAuthenticated) {
                    // Se já está logado, vai para o painel
                    window.location.hash = '#dashboard';
                } else {
                    // Mostra login ou cadastro
                    const pageId = hash.substring(1); // 'login' ou 'signup'
                    document.getElementById(pageId).style.display = 'flex';
                }
            } else if (hash === '#logout') {
                handleLogout();
            } else {
                // Telas públicas (agendamento, etc.)
                // Por enquanto, #booking é a principal
                document.getElementById('public-booking').style.display = 'block';
                loadServicesBooking(); // Carrega serviços na tela de agendamento
            }
            
            updateNavUI(isAuthenticated);
        }
        
        // Atualiza links de navegação com base no login
        function updateNavUI(isAuthenticated) {
            const navLogin = document.getElementById('nav-public-login');
            const navDashboard = document.getElementById('nav-public-dashboard');
            
            if (isAuthenticated) {
                navLogin.textContent = 'Sair';
                navLogin.href = '#logout';
                navDashboard.style.display = 'inline-block';
            } else {
                navLogin.textContent = 'Minha Conta';
                navLogin.href = '#login';
                navDashboard.style.display = 'none';
            }
        }
        
        // Navegação interna do Painel Admin
        function navigateToAdminPanel(hash) {
            let targetPanelId = 'panel-dashboard'; // Padrão
            let targetLink = document.querySelector('.nav-link-admin[data-target="panel-dashboard"]');

            if (hash !== '#dashboard') {
                const cleanHash = hash.substring(1); // remove #
                const foundLink = document.querySelector(`.nav-link-admin[href="${hash}"]`);
                if (foundLink) {
                    targetPanelId = foundLink.dataset.target;
                    targetLink = foundLink;
                }
            }
            
            // Esconde todos os painéis
            allAdminPanels.forEach(panel => panel.style.display = 'none');
            // Mostra o painel alvo
            document.getElementById(targetPanelId).style.display = 'block';
            
            // Atualiza links da sidebar
            adminNavLinks.forEach(link => link.classList.remove('active', 'bg-blue-700'));
            targetLink.classList.add('active', 'bg-blue-700');
            
            // Atualiza título do painel
            adminPanelTitle.textContent = targetLink.textContent.trim();
            
            // Lógica de carregamento de dados para cada painel
            switch(targetPanelId) {
                case 'panel-dashboard':
                    adminPanelSubtitle.textContent = `Olá, ${appState.currentUser.nome}! Veja seu resumo.`;
                    break;
                case 'panel-servicos':
                    adminPanelSubtitle.textContent = 'Adicione, edite ou remova os serviços oferecidos.';
                    loadServicesAdmin();
                    break;
                case 'panel-clientes':
                    adminPanelSubtitle.textContent = 'Visualize e gerencie as informações dos seus clientes.';
                    loadClientsCRM();
                    break;
                case 'panel-financeiro':
                    adminPanelSubtitle.textContent = 'Olá, Carlos! Aqui estão suas métricas financeiras.'; // Simulado
                    break;
                default:
                    adminPanelSubtitle.textContent = 'Gerencie sua barbearia.';
            }
        }

        // =============================================
        // == AUTENTICAÇÃO (Login / Cadastro / Logout) ==
        // =============================================

        // Armazena dados do usuário no localStorage
        function setCurrentUser(user) {
            appState.currentUser = user;
            localStorage.setItem('barbeariaUser', JSON.stringify(user));
            // Atualiza dados no painel admin se estiver visível
            userNameEl.textContent = user.nome;
            document.getElementById('userProfileName').textContent = user.tipoPerfil;
            // Placeholder de avatar
            const userInitial = user.nome ? user.nome.charAt(0).toUpperCase() : 'U';
            document.getElementById('userAvatar').src = `https://placehold.co/40x40/E2E8F0/718096?text=${userInitial}`;
        }
        
        // Pega dados do usuário do localStorage
        function getCurrentUser() {
            if (appState.currentUser) {
                return appState.currentUser;
            }
            const user = localStorage.getItem('barbeariaUser');
            if (user) {
                appState.currentUser = JSON.parse(user);
                return appState.currentUser;
            }
            return null;
        }
        
        // Logout
        function handleLogout() {
            appState.currentUser = null;
            localStorage.removeItem('barbeariaUser');
            window.location.hash = '#login';
            showToast('success', 'Você saiu com sucesso.');
        }

        // --- Event Listener: Cadastro ---
        const signupForm = document.getElementById('signupForm');
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const nome = document.getElementById('signupNome').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const tipoPerfil = document.getElementById('signupTipoPerfil').value;
            
            // Validação de senha
            if (password !== confirmPassword) {
                document.getElementById('passwordError').style.display = 'block';
                return;
            }
            document.getElementById('passwordError').style.display = 'none';
            
            const data = { nome, email, tipoPerfil };
            // NOTA: Não estamos enviando a senha! Nosso backend não a armazena (ainda).
            
            const result = await callApi('createUser', data);
            
            if (result.status === 'success') {
                showToast('success', 'Conta criada com sucesso! Faça o login.');
                window.location.hash = '#login';
            } else {
                showToast('error', `Erro ao cadastrar: ${result.message}`);
            }
        });

        // --- Event Listener: Login ---
        const loginForm = document.getElementById('loginForm');
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            // NOTA: A senha não está sendo usada no backend (MVP)
            const password = document.getElementById('loginPassword').value; 
            
            const result = await callApi('loginUser', { email, password });
            
            if (result.status === 'success' && result.data) {
                setCurrentUser(result.data); // Armazena o usuário
                showToast('success', `Bem-vindo de volta, ${result.data.nome}!`);
                
                // Redireciona com base no perfil
                if (result.data.tipoPerfil === 'Admin' || result.data.tipoPerfil === 'Barbeiro') {
                    window.location.hash = '#dashboard';
                } else {
                    window.location.hash = '#booking'; // Cliente vai para agendamento
                }
            } else {
                showToast('error', `Falha no login: ${result.message}`);
            }
        });

        // --- Event Listener: Seleção de Perfil no Cadastro ---
        document.querySelectorAll('.profile-toggle-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                // Reseta todos os botões
                document.querySelectorAll('.profile-toggle-btn').forEach(btn => {
                    btn.classList.remove('bg-primary', 'text-white');
                    btn.classList.add('text-gray-600');
                });
                // Ativa o botão clicado
                e.currentTarget.classList.add('bg-primary', 'text-white');
                e.currentTarget.classList.remove('text-gray-600');
                // Define o valor do input hidden
                if (e.currentTarget.id === 'btn-profile-cliente') {
                    document.getElementById('signupTipoPerfil').value = 'Cliente';
                } else if (e.currentTarget.id === 'btn-profile-barbeiro') {
                    document.getElementById('signupTipoPerfil').value = 'Barbeiro';
                } else {
                    document.getElementById('signupTipoPerfil').value = 'Admin';
                }
            });
        });
        
        // =============================================
        // == LÓGICA DE DADOS - AGENDAMENTO (PÚBLICO) ==
        // =============================================
        
        async function loadServicesBooking() {
            const listEl = document.getElementById('servicesList');
            // Mostra o loading
            listEl.innerHTML = `
                <div class="border rounded-lg p-4 text-center text-gray-500">
                    <div class="h-40 bg-gray-200 rounded-md animate-pulse mb-4"></div>
                    <div class="h-6 bg-gray-200 rounded-md animate-pulse w-3/4 mx-auto mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded-md animate-pulse w-1/2 mx-auto"></div>
                </div>
                <div class="border rounded-lg p-4 text-center text-gray-500">
                    <div class="h-40 bg-gray-200 rounded-md animate-pulse mb-4"></div>
                    <div class="h-6 bg-gray-200 rounded-md animate-pulse w-3/4 mx-auto mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded-md animate-pulse w-1/2 mx-auto"></div>
                </div>
                <div class="border rounded-lg p-4 text-center text-gray-500">
                    <div class="h-40 bg-gray-200 rounded-md animate-pulse mb-4"></div>
                    <div class="h-6 bg-gray-200 rounded-md animate-pulse w-3/4 mx-auto mb-2"></div>
                    <div class="h-4 bg-gray-200 rounded-md animate-pulse w-1/2 mx-auto"></div>
                </div>`;
            
            const result = await callApi('readServices');
            
            if (result.status === 'success' && result.data) {
                appState.services = result.data; // Salva no estado
                listEl.innerHTML = ''; // Limpa o loading
                
                if (result.data.length === 0) {
                    listEl.innerHTML = '<p class="text-gray-600 col-span-3 text-center">Nenhum serviço disponível no momento.</p>';
                    return;
                }
                
                result.data.forEach(service => {
                    const card = document.createElement('div');
                    card.className = 'service-card border rounded-lg p-5 cursor-pointer hover:shadow-lg hover:border-primary transition-all';
                    card.dataset.serviceId = service.id;
                    card.innerHTML = `
                        <img src="https://placehold.co/300x200/E2E8F0/718096?text=${service.nome.replace(' ', '+')}" alt="${service.nome}" class="w-full h-40 object-cover rounded-md mb-4">
                        <h4 class="text-xl font-semibold mb-1">${service.nome}</h4>
                        <p class="text-gray-500 text-sm mb-3">Duração: ${service.duracao} min</p>
                        <p class="text-2xl font-bold text-primary">R$ ${service.preco.toFixed(2).replace('.', ',')}</p>
                    `;
                    // Event listener para seleção de serviço
                    card.addEventListener('click', () => {
                        // Remove seleção de outros cards
                        document.querySelectorAll('.service-card').forEach(c => c.classList.remove('border-primary', 'ring-2', 'ring-primary'));
                        // Adiciona seleção neste card
                        card.classList.add('border-primary', 'ring-2', 'ring-primary');
                        appState.selectedService = service;
                        document.getElementById('btn-next-step-1').disabled = false;
                    });
                    listEl.appendChild(card);
                });
            } else {
                listEl.innerHTML = `<p class="text-red-500 col-span-3 text-center">Erro ao carregar serviços: ${result.message}</p>`;
            }
        }
        
        // =============================================
        // == LÓGICA DE DADOS - ADMIN SERVIÇOS       ==
        // =============================================

        const serviceModal = document.getElementById('serviceModal');
        const serviceForm = document.getElementById('serviceForm');

        // Abrir modal (para criar)
        document.getElementById('btn-add-service-modal').addEventListener('click', () => {
            serviceForm.reset();
            document.getElementById('serviceId').value = '';
            document.getElementById('serviceModalTitle').textContent = 'Adicionar Novo Serviço';
            serviceModal.style.display = 'flex';
        });
        document.getElementById('btn-add-service-empty').addEventListener('click', () => {
            serviceForm.reset();
            document.getElementById('serviceId').value = '';
            document.getElementById('serviceModalTitle').textContent = 'Adicionar Novo Serviço';
            serviceModal.style.display = 'flex';
        });
        
        // Fechar modal
        document.getElementById('closeServiceModal').addEventListener('click', () => serviceModal.style.display = 'none');
        document.getElementById('cancelServiceModal').addEventListener('click', () => serviceModal.style.display = 'none');

        // Carregar serviços no painel Admin
        async function loadServicesAdmin() {
            const listEl = document.getElementById('adminServicesList');
            const emptyEl = document.getElementById('adminServicesEmpty');
            listEl.innerHTML = '<tr><td colspan="4" class="p-6 text-center text-gray-500">Carregando serviços...</td></tr>';
            emptyEl.style.display = 'none';
            
            const result = await callApi('readServices');
            
            if (result.status === 'success' && result.data) {
                appState.services = result.data; // Atualiza estado
                listEl.innerHTML = ''; // Limpa o loading
                
                if (result.data.length === 0) {
                    listEl.innerHTML = '';
                    emptyEl.style.display = 'block';
                    return;
                }
                
                emptyEl.style.display = 'none';
                result.data.forEach(service => {
                    const row = document.createElement('tr');
                    row.className = 'border-b';
                    row.innerHTML = `
                        <td class="p-4">
                            <span class="font-semibold">${service.nome}</span>
                        </td>
                        <td class="p-4">R$ ${service.preco.toFixed(2).replace('.', ',')}</td>
                        <td class="p-4">${service.duracao} min</td>
                        <td class="p-4">
                            <button class="btn-edit-service text-blue-600 hover:text-blue-800 mr-3" data-id="${service.id}">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                            <button class="btn-delete-service text-red-600 hover:text-red-800" data-id="${service.id}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    listEl.appendChild(row);
                });
                
                // Adiciona Event Listeners para botões de ação
                addServiceActionListeners();
                
            } else {
                listEl.innerHTML = `<tr><td colspan="4" class="p-6 text-center text-red-500">Erro ao carregar serviços: ${result.message}</td></tr>`;
            }
        }
        
        // Salvar (Criar ou Editar) Serviço
        serviceForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const id = document.getElementById('serviceId').value;
            const data = {
                nome: document.getElementById('serviceName').value,
                preco: parseFloat(document.getElementById('servicePrice').value),
                duracao: parseInt(document.getElementById('serviceDuration').value),
                descricao: document.getElementById('serviceDescription').value,
            };
            
            let action = 'createService';
            if (id) {
                action = 'updateService';
                data.id = id;
            }
            
            const result = await callApi(action, data);
            
            if (result.status === 'success') {
                showToast('success', `Serviço ${id ? 'atualizado' : 'criado'} com sucesso!`);
                serviceModal.style.display = 'none';
                loadServicesAdmin(); // Recarrega a lista
            } else {
                showToast('error', `Erro ao salvar: ${result.message}`);
            }
        });
        
        // Adiciona listeners para botões de editar/deletar
        function addServiceActionListeners() {
            // Editar
            document.querySelectorAll('.btn-edit-service').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = e.currentTarget.dataset.id;
                    const service = appState.services.find(s => s.id === id);
                    if (service) {
                        document.getElementById('serviceId').value = service.id;
                        document.getElementById('serviceName').value = service.nome;
                        document.getElementById('servicePrice').value = service.preco;
                        document.getElementById('serviceDuration').value = service.duracao;
                        document.getElementById('serviceDescription').value = service.descricao || '';
                        document.getElementById('serviceModalTitle').textContent = 'Editar Serviço';
                        serviceModal.style.display = 'flex';
                    }
                });
            });
            
            // Deletar
            document.querySelectorAll('.btn-delete-service').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const id = e.currentTarget.dataset.id;
                    // Simples confirmação (o ideal é um modal de confirmação)
                    if (confirm('Tem certeza que deseja excluir este serviço?')) {
                        const result = await callApi('deleteService', { id });
                        if (result.status === 'success') {
                            showToast('success', 'Serviço excluído com sucesso!');
                            loadServicesAdmin(); // Recarrega a lista
                        } else {
                            showToast('error', `Erro ao excluir: ${result.message}`);
                        }
                    }
                });
            });
        }
        
        // =============================================
        // == LÓGICA DE DADOS - ADMIN CLIENTES (CRM)  ==
        // =============================================
        
        async function loadClientsCRM() {
            const listEl = document.getElementById('clientListCRM');
            const detailEl = document.getElementById('clientDetailCRM');
            listEl.innerHTML = '<div class="p-4 text-center text-gray-500">Carregando clientes...</div>';
            
            const result = await callApi('readClients');
            
            if (result.status === 'success' && result.data) {
                appState.clients = result.data;
                listEl.innerHTML = '';
                
                if (result.data.length === 0) {
                    listEl.innerHTML = '<div class="p-4 text-center text-gray-500">Nenhum cliente cadastrado.</div>';
                    return;
                }
                
                result.data.forEach(client => {
                    const clientCard = document.createElement('div');
                    clientCard.className = 'client-card-crm flex items-center justify-between p-4 hover:bg-gray-50 cursor-pointer';
                    clientCard.dataset.clientId = client.id;
                    clientCard.innerHTML = `
                        <div class="flex items-center">
                            <img src="https://placehold.co/40x40/E2E8F0/718096?text=${client.nome.charAt(0).toUpperCase()}" alt="Avatar" class="w-10 h-10 rounded-full mr-3">
                            <div>
                                <p class="font-semibold">${client.nome}</p>
                                <span class="text-sm text-gray-500">Último serviço: ${client.ultimoServico || 'N/D'}</span>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    `;
                    
                    // Evento de clique para mostrar detalhes
                    clientCard.addEventListener('click', () => {
                        // Destaque visual
                        document.querySelectorAll('.client-card-crm').forEach(card => card.classList.remove('bg-blue-50', 'border-l-4', 'border-primary'));
                        clientCard.classList.add('bg-blue-50', 'border-l-4', 'border-primary');
                        // Renderiza detalhes
                        renderClientDetail(client.id);
                    });
                    
                    listEl.appendChild(clientCard);
                });
                
            } else {
                listEl.innerHTML = `<div class="p-4 text-center text-red-500">Erro ao carregar clientes: ${result.message}</div>`;
            }
        }
        
        function renderClientDetail(clientId) {
            const client = appState.clients.find(c => c.id === clientId);
            if (!client) return;
            
            const detailEl = document.getElementById('clientDetailCRM');
            detailEl.innerHTML = `
                <div class="flex justify-between items-start mb-6">
                    <div class="flex items-center">
                        <img src="https://placehold.co/80x80/E2E8F0/718096?text=${client.nome.charAt(0).toUpperCase()}" alt="Avatar" class="w-20 h-20 rounded-full mr-4">
                        <div>
                            <h2 class="text-2xl font-bold">${client.nome}</h2>
                            <p class="text-gray-500">Cliente desde ${new Date().toLocaleDateString('pt-BR')} <!-- Simulado --></p>
                        </div>
                    </div>
                    <div>
                        <button class="py-2 px-4 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 mr-2"><i class="fas fa-phone mr-2"></i></button>
                        <button class="py-2 px-4 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 mr-2"><i class="fas fa-comment-dots mr-2"></i></button>
                        <button class="bg-primary text-white py-2 px-4 rounded-lg font-semibold hover:bg-opacity-90">Agendar Novo</button>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-8 mb-6">
                    <!-- Informações de Contato -->
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">Informações de Contato</h4>
                        <p class="text-sm text-gray-600"><strong>Telefone:</strong> ${client.telefone || 'Não informado'}</p>
                        <p class="text-sm text-gray-600"><strong>Email:</strong> ${client.email || '
